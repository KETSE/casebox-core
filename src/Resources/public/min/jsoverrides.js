Ext.override(Ext.Ajax,{initDisplayMsg:function(){this.displayMsgTimeout=1500;this.displayMsgTask=new Ext.util.DelayedTask(this.onDisplayMsgDelay,this,[],false);this.loadingMsgDiv=App.getNotificationDiv();this.loadingMsgDiv.update('<div class="content">'+Ext.LoadMask.prototype.msg+'</div>');},request:function(options){var request=this.callParent(arguments);if(request){request.startTime=new Date();}
if(!this.displayMsgTask){this.initDisplayMsg();}
this.displayMsgTask.delay(this.displayMsgTimeout);return request;},onDisplayMsgDelay:function(){var requests=this.requests,id,empty=true,time=new Date(),displayMsg=false;for(id in requests){if(requests.hasOwnProperty(id)){if(Ext.isEmpty(requests[id].timedout)&&((time-requests[id].startTime)<6000)){empty=false;if(time-requests[id].startTime>this.displayMsgTimeout){displayMsg=true;}}}}
if(empty){this.displayMsgTask.cancel();this.loadingMsgDiv.hide();}else if(displayMsg){this.displayMsgTask.delay(this.displayMsgTimeout);this.loadingMsgDiv.show();this.loadingMsgDiv.getEl().fadeIn();this.loadingMsgDiv.task.delay(3000);}}});;Ext.define('Ext.patch,EXTJS16166',{override:'Ext.view.View',compatibility:'5.1.0.107',handleEvent:function(e){var me=this,isKeyEvent=me.keyEventRe.test(e.type),nm=me.getNavigationModel();e.view=me;if(isKeyEvent){e.item=nm.getItem();e.record=nm.getRecord();}
if(!e.item){e.item=e.getTarget(me.itemSelector);}
if(e.item&&!e.record){e.record=me.getRecord(e.item);}
if(me.processUIEvent(e)!==false){me.processSpecialEvent(e);}
if(isKeyEvent&&!Ext.fly(e.target).isInputField()){if(e.getKey()===e.SPACE||e.isNavKeyPress(true)){e.preventDefault();}}}});Ext.define('Ext.overrides.util.Collection',{override:'Ext.util.Collection',compatibility:'5.1.0.107',updateKey:function(item,oldKey){var me=this,map=me.map,indices=me.indices,source=me.getSource(),newKey;if(source&&!source.updating){source.updateKey(item,oldKey);}
else if(map[oldKey]&&(newKey=me.getKey(item))!==oldKey){if(oldKey in map||map[newKey]!==item){if(oldKey in map){if(map[oldKey]!==item){Ext.Error.raise('Incorrect oldKey "'+oldKey+'" for item with newKey "'+newKey+'"');}
delete map[oldKey];}
me.updating++;me.generation++;map[newKey]=item;if(indices){indices[newKey]=indices[oldKey];delete indices[oldKey];}
me.notify('updatekey',[{item:item,newKey:newKey,oldKey:oldKey}]);me.updating--;}}}});Ext.define('My.override.VBoxLayoutFix',{override:'Ext.layout.container.VBox',beginLayout:function(ownerContext){var scrollable=this.owner.getScrollable();if(scrollable){this.lastScrollPosition=scrollable.getPosition();}
this.callParent(arguments);},completeLayout:function(ownerContext){var scrollable=this.owner.getScrollable();this.callParent(arguments);if(scrollable){scrollable.scrollTo(this.lastScrollPosition);}}});if(Ext.isChrome&&Ext.chromeVersion===43){Ext.getBody().addCls('chrome-43');};Ext.namespace('Ext.calendar.view');Ext.override(Ext.calendar.dd.DayDropZone,{onNodeOver:function(n,dd,e,data){var dt,box,endDt,text=this.createText,curr,start,end,evtEl,dayCol;if(data.type==='caldrag'){if(!this.dragStartMarker){this.dragStartMarker=n.el.parent().createChild({style:'position:absolute;'});this.dragStartMarker.setBox(n.timeBox);this.dragCreateDt=n.date;}
box=this.dragStartMarker.getBox();box.height=Math.ceil(Math.abs(e.xy[1]-box.y)/n.timeBox.height)*n.timeBox.height;if(e.xy[1]<box.y){box.height+=n.timeBox.height;box.y=box.y-box.height+n.timeBox.height;endDt=Ext.Date.add(this.dragCreateDt,Ext.Date.MINUTE,30);}
else{n.date=Ext.Date.add(n.date,Ext.Date.MINUTE,30);}
this.shim(this.dragCreateDt,box);curr=Ext.calendar.util.Date.copyTime(n.date,this.dragCreateDt);this.dragStartDate=Ext.calendar.util.Date.min(this.dragCreateDt,curr);this.dragEndDate=endDt||Ext.calendar.util.Date.max(this.dragCreateDt,curr);dt=Ext.Date.format(this.dragStartDate,App.timeFormat+'-')+Ext.Date.format(this.dragEndDate,App.timeFormat);}
else{evtEl=Ext.get(data.ddel);dayCol=evtEl.parent().parent();box=evtEl.getBox();box.width=dayCol.getWidth();if(data.type==='eventdrag'){if(this.dragOffset===undefined){this.dragOffset=n.timeBox.y-box.y;box.y=n.timeBox.y-this.dragOffset;}
else{box.y=n.timeBox.y;}
dt=Ext.Date.format(n.date,'n/j '+App.timeFormat);box.x=n.el.getX();this.shim(n.date,box);text=this.moveText;}
if(data.type==='eventresize'){if(!this.resizeDt){this.resizeDt=n.date;}
box.x=dayCol.getX();box.height=Math.ceil(Math.abs(e.xy[1]-box.y)/n.timeBox.height)*n.timeBox.height;if(e.xy[1]<box.y){box.y-=box.height;}
else{n.date=Ext.Date.add(n.date,Ext.Date.MINUTE,30);}
this.shim(this.resizeDt,box);curr=Ext.calendar.util.Date.copyTime(n.date,this.resizeDt);start=Ext.calendar.util.Date.min(data.eventStart,curr);end=Ext.calendar.util.Date.max(data.eventStart,curr);data.resizeDates={StartDate:start,EndDate:end};dt=Ext.Date.format(start,App.timeFormat+'-')+Ext.Date.format(end,App.timeFormat);text=this.resizeText;}}
data.proxy.updateMsg(Ext.util.Format.format(text,dt));return this.dropAllowed;}});;Ext.namespace('Ext.calendar.form.field');Ext.override(Ext.calendar.form.field.DateRange,{toText:L.to,allDayText:L.AllDay});;Ext.namespace('Ext.calendar.view');Ext.override(Ext.calendar.template.BoxLayout,{getTodayText:function(){var dt=Ext.Date.format(new Date(),'l, F j, Y'),fmt,todayText=this.showTodayText!==false?this.todayText:'',timeText=this.showTime!==false?' <span id="'+this.id+'-clock" class="ext-cal-dtitle-time">'+
Ext.Date.format(new Date(),App.timeFormat)+'</span>':'',separator=todayText.length>0||timeText.length>0?' &mdash; ':'';if(this.dayCount==1){return dt+separator+todayText+timeText;}
fmt=this.weekCount==1?'D j':'j';return todayText.length>0?todayText+timeText:Ext.Date.format(new Date(),fmt)+timeText;}});;Ext.namespace('Ext.calendar.view');Ext.override(Ext.calendar.view.Day,{todayText:L.Today});;Ext.namespace('Ext.calendar.view');Ext.override(Ext.calendar.view.DayBody,{getTemplateEventData:function(evt){var selector=this.getEventSelectorCls(evt[Ext.calendar.data.EventMappings.EventId.name]),data={},M=Ext.calendar.data.EventMappings;this.getTemplateEventBox(evt);data._selectorCls=selector;data._colorCls='ext-color-'+(evt[M.CalendarId.name]||'0')+(evt._renderAsAllDay?'-ad':'');data._elId=selector+(evt._weekIndex?'-'+evt._weekIndex:'');data._isRecurring=evt.Recurrence&&!Ext.isEmpty(evt.Recurrence);data._isReminder=evt[M.Reminder.name]&&!Ext.isEmpty(evt[M.Reminder.name]);var title=evt[M.Title.name];data.Title=(evt[M.IsAllDay.name]?'':Ext.Date.format(evt[M.StartDate.name],App.timeFormat+' '))+Ext.valueFrom(title,'(No title)');return Ext.applyIf(data,evt);}});;Ext.namespace('Ext.calendar.view');Ext.override(Ext.calendar.view.Month,{todayText:L.Today,initClock:function(){if(Ext.fly(this.id+'-clock')!==null){this.prevClockDay=new Date().getDay();if(this.clockTask){Ext.TaskManager.stop(this.clockTask);}
this.clockTask=Ext.TaskManager.start({run:function(){var el=Ext.fly(this.id+'-clock'),t=new Date();if(t.getDay()==this.prevClockDay){if(el){el.update(Ext.Date.format(t,App.timeFormat));}}
else{this.prevClockDay=t.getDay();this.moveTo(t);}},scope:this,interval:1000});}},getTemplateEventData:function(evt){var M=Ext.calendar.data.EventMappings,selector=this.getEventSelectorCls(evt[M.EventId.name]),title=evt[M.Title.name];return Ext.applyIf({_selectorCls:selector,_colorCls:'ext-color-'+(evt[M.CalendarId.name]?evt[M.CalendarId.name]:'default')+(evt._renderAsAllDay?'-ad':''),_elId:selector+'-'+evt._weekIndex,_isRecurring:evt.Recurrence&&!Ext.isEmpty(evt.Recurrence),_isReminder:evt[M.Reminder.name]&&!Ext.isEmpty(evt[M.Reminder.name]),Title:(evt[M.IsAllDay.name]?'':Ext.Date.format(evt[M.StartDate.name],App.timeFormat+' '))+Ext.valueFrom(title,'(No title)'),_operaLT11:this.operaLT11?'ext-operaLT11':''},evt);}});;Ext.namespace('Ext.calendar');Ext.override(Ext.calendar.CalendarPanel,{todayText:L.Today,dayText:L.Day,weekText:L.Week,monthText:L.Month});;Ext.namespace('Ext.data');Ext.override(Ext.data.Store,{deleteIds:function(ids){var idx,idProperty=(Ext.isEmpty(this.proxy)||Ext.isEmpty(this.proxy.reader))?'id':Ext.valueFrom(Ext.valueFrom(this.proxy.reader.idProperty,this.proxy.reader.config.idProperty),'id');if(Ext.isPrimitive(ids)){ids=String(ids).split(',');}
if((this.getCount()>0)&&this.data){for(var i=0;i<ids.length;i++){idx=this.findExact(idProperty,String(ids[i]));if(idx<0){idx=this.findExact(idProperty,parseInt(ids[i],10));}
if(idx>=0){this.removeAt(idx);}}}}});;Ext.override(Ext.grid.plugin.CellEditing,{onEditComplete:function(ed,value,startValue){if(ed.field){if(ed.field.preventEditComplete){delete ed.field.preventEditComplete;return;}}
this.callParent(arguments);}});;Ext.override(Ext.grid.CellEditor,{onEditComplete:function(remainVisible){if(this.field){if(this.field.preventEditComplete){return;}}
this.callParent(arguments);}});;Ext.override(Ext.grid.GridPanel,{getState:function(remainVisible){var rez={columns:{}},store=this.store,cols=this.headerCt.getGridColumns(),gs,c,di;for(var i=0;i<cols.length;i++){c=cols[i];di=c.dataIndex;rez.columns[di]={idx:i};if(c.width){rez.columns[di].width=c.width;}
if(c.hidden){rez.columns[di].hidden=true;}
if(c.sortable){rez.columns[di].sortable=true;}
if(c.locked){rez.columns[di].locked=true;}
if(c.flex){rez.columns[di].flex=c.flex;}}
if(store){var ss=store.getSorters().getAt(0);if(ss&&ss.getState){rez.sort=ss.getState();}
if(store.getGrouper){rez.group=store.getGrouper();if(rez.group){rez.group=rez.group.config;rez.group.property=store.proxy.extraParams.sourceGroupField;}}}
return rez;}});;Ext.override(Ext.tree.ViewDragZone,{lastClickAt:null,b4MouseDown:function(e){var view=this.view,sm=view.getSelectionModel();this.lastClickAt=e.getXY();if(sm){view.suspendEvents(true);sm.suspendEvents(true);}
this.callParent(arguments);}});Ext.override(Ext.tree.ViewDragZone,{onMouseUp:function(e){var view=this.view,sm=view.getSelectionModel();var loc=e.getXY();if(sm&&(Ext.isEmpty(this.lastClickAt)||(this.lastClickAt[0]==loc[0]&&this.lastClickAt[1]==loc[1]))){sm.resumeEvents();view.resumeEvents();}else{sm.resumeEvents(true);view.resumeEvents(true);}
this.callParent(arguments);}});;Ext.override(Ext.toolbar.Toolbar,{hideInutilSeparators:function(){var vi=[];this.items.each(function(i,idx,len){if(i.isVisible()){vi.push(i);}},this);for(var i=0;i<vi.length;i++){if(vi[i].xtype==='tbseparator'){vi[i].setHidden((i===0)||(i==(vi.length-1))||(vi[i+1].xtype==='tbfill')||(vi[i-1].xtype==='tbfill')||(vi[i-1].xtype==='tbseparator'));}}}});;Ext.namespace('Ext.util');Ext.util.Collection.prototype._getAt=Ext.util.Collection.prototype.getAt;Ext.util.Collection.prototype.getAt=function(index){if(Ext.isEmpty(this.items)){clog('Found MixedCollextion with empty "items" property',this);return'null';}
return this._getAt(index);};;Ext.namespace('Ext.util');Ext.override(Ext.util.AbstractMixedCollection,{get:function(key){var rez=this.callParent(arguments);if(Ext.isEmpty(rez)&&Ext.isPrimitive(key)){var idx=this.findIndex('itemId',key);if(idx>-1){rez=this.getAt(idx);}}
return rez;},indexOfKey:function(key){if(!this.map.hasOwnProperty(key)){this.length=this.items.length;return this.keys.indexOf(key);}
if(this.indexGeneration!==this.generation){this.rebuildIndexMap();}
return this.indexMap[key];}});;Ext.namespace('Ext.util');Ext.util.Format.stripTags=function(str,allow){str=String(str);allow=(((allow||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join('');var tags=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;var commentsAndPhpTags=/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;return str.replace(commentsAndPhpTags,'').replace(tags,function($0,$1){return allow.indexOf('<'+$1.toLowerCase()+'>')>-1?$0:'';});};